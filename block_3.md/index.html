<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <title>reveal-md</title>
        <link rel="stylesheet" href="./css/reveal.css">
        <link rel="stylesheet" href="https://keetraxx.github.io/pitc-revealjs-theme/puzzle.css" id="theme">
        <link rel="stylesheet" href="./css/highlight/zenburn.css">
        <link rel="stylesheet" href="./css/print/paper.css" type="text/css" media="print">


    </head>
    <body>

        <div class="reveal">
            <div class="slides"><section  data-markdown><script type="text/template"># Spring Boot Block 3

## Spring Boot Testing

<small>13.09.2018 - tran@puzzle.ch</small>

<!-- .slide: class="master03" -->
</script></section><section  data-markdown><script type="text/template">
## Spring Boot Testing

1. Unit Testing
2. Integration Testing
</script></section><section  data-markdown><script type="text/template">
## Unit Testing with Spring Boot

### What's a unit test?

* Tests a single class
* Everything outside it is mocked.
</script></section><section  data-markdown><script type="text/template">
### What's a integration test?

* Tests multiple classes working togehter.
</script></section><section  data-markdown><script type="text/template">
## spring-boot-starter-test

* JUnit
* Spring Test
* AssertJ
* Hamcrest
* Mockito
* JSONassert
* JsonPath
</script></section><section  data-markdown><script type="text/template">
### Example: Isolated `@RestController` test

```java
import static org.hamcrest.Matchers.is;
import static org.mockito.BDDMockito.given;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.*;

@RunWith(SpringRunner.class)
@WebMvcTest(PuzzleMemberController.class)
public class PuzzleMemberControllerTests {

    @Autowired
    private MockMvc mvc;

    @MockBean
    private PuzzleMemberRepository repository;

    private PuzzleMember mockPuzzleMember = new PuzzleMember("Hans", "Muster", 3);

    @Test
    public void incrementCoffeeConsumption() throws Exception {
        given(repository.save(mockPuzzleMember)).willReturn(mockPuzzleMember);
        given(repository.findById(42L)).willReturn(Optional.of(mockPuzzleMember));

        mvc.perform(post("/api/puzzle-members/drink-coffee")
                .contentType(MediaType.TEXT_PLAIN)
                .content("42"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.coffeeConsumption", is(4)))
                .andExpect(jsonPath("$.firstName", is("Hans")))
                .andExpect(jsonPath("$.lastName", is("Muster")));
    }

    @Test
    public void noUserFound() throws Exception {
        mvc.perform(post("/api/puzzle-members/drink-coffee")
                .contentType(MediaType.TEXT_PLAIN)
                .content("43"))
                .andDo(print())
                .andExpect(status().is4xxClientError());
    }
}

```
</script></section><section  data-markdown><script type="text/template">
### Example: Integration test

[Link to example app test](https://github.com/KeeTraxx/springboot-workshop-2018-app/blob/master/src/test/java/ch/puzzle/springboot/workshop/example/PuzzleMemberIntegrationTests.java)
</script></section><section  data-markdown><script type="text/template">
### Good to know

* Put a `application.properties` in `/src/test/resources`
* Tests will always expect all `@Bean`s to be present or mocked
</script></section><section  data-markdown><script type="text/template">
## Free time

* Questions?
* Share experiences?
* Work on your application
* Explore more Spring Boot stuff:
 - WebFlux
 - WebSockets
 - Spring Cloud
 - Spring Hateoas
 - Spring Security
 - [...]

## Thank you!</script></section></div>
        </div>

        <script src="./lib/js/head.min.js"></script>
        <script src="./js/reveal.js"></script>

        <script>
            function extend() {
              var target = {};
              for (var i = 0; i < arguments.length; i++) {
                var source = arguments[i];
                for (var key in source) {
                  if (source.hasOwnProperty(key)) {
                    target[key] = source[key];
                  }
                }
              }
              return target;
            }

            // Optional libraries used to extend on reveal.js
            var deps = [
              { src: './lib/js/classList.js', condition: function() { return !document.body.classList; } },
              { src: './plugin/markdown/marked.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: './plugin/markdown/markdown.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: './plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
              { src: './plugin/zoom-js/zoom.js', async: true },
              { src: './plugin/notes/notes.js', async: true },
              { src: './plugin/math/math.js', async: true }
            ];

            // default options to init reveal.js
            var defaultOptions = {
              controls: true,
              progress: true,
              history: true,
              center: true,
              transition: 'default', // none/fade/slide/convex/concave/zoom
              dependencies: deps
            };

            // options from URL query string
            var queryOptions = Reveal.getQueryHash() || {};

            var options = {};
            options = extend(defaultOptions, options, queryOptions);
        </script>

          <script src="./_assets/src/scripts/code-copy.js"></script>

        <script>
          Reveal.initialize(options);
        </script>
    </body>
</html>
